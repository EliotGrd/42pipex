/****** BONUS ******/

/*** Commandes ***/

./pipex_bonus tests_bonus/infiles/basic.txt "cat" "grep Hello" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/basic.txt "cat" "tr a-z A-Z" "grep HELLO" "wc -c" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/empty.txt "cat" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/basic.txt "" "cat" "wc -l" tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/basic.txt "cat" "wssqwdwe" "wc -l" tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/basic.txt "cat" "cat" "cat" "cat" "cat" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/basic.txt "/bin/cat" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile

cp /bin/cat ./cat
chmod +x ./cat
./pipex_bonus tests_bonus/infiles/basic.txt "./cat" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
rm ./cat

./pipex_bonus tests_bonus/infiles/basic.txt "grep notfound" "cat" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

./pipex_bonus tests_bonus/infiles/basic.txt "ls /doesnotexist" "cat" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?


/*** Heredoc ***/

./pipex_bonus here_doc END "cat" "wc -c" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

./pipex_bonus here_doc END "cat" "dghghdej" tests_bonus/outfiles/outfile
echo $?

touch tests_bonus/outfiles/outfile_no_perm
chmod 000 tests_bonus/outfiles/outfile_no_perm
./pipex_bonus here_doc END "cat" "wc -c" tests_bonus/outfiles/outfile_no_perm
echo $?
chmod 644 tests_bonus/outfiles/outfile_no_perm

./pipex_bonus here_doc "" "cat" "wc -c" tests_bonus/outfiles/outfile
echo $?

./pipex_bonus here_doc END "cat" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

/*** Usage incorrect ***/

./pipex_bonus
./pipex_bonus tests_bonus/infiles/basic.txt "cat" tests_bonus/outfiles/outfile
echo $?

/*** Erreurs fichiers ***/

./pipex_bonus tests_bonus/infiles/nope.txt "cat" "wc -l" tests_bonus/outfiles/outfile
echo $?

echo "secret" > tests_bonus/infiles/noperm.txt
chmod 000 tests_bonus/infiles/noperm.txt
./pipex_bonus tests_bonus/infiles/noperm.txt "cat" "wc -l" tests_bonus/outfiles/outfile
echo $?
chmod 644 tests_bonus/infiles/noperm.txt

echo "old content" > tests_bonus/outfiles/outfile
./pipex_bonus tests_bonus/infiles/basic.txt "cat" "wc -l" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile

/*** Args vides ***/

./pipex_bonus tests_bonus/infiles/basic.txt "" "" "" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?
./pipex_bonus here_doc END "" "" "" tests_bonus/outfiles/outfile
cat tests_bonus/outfiles/outfile
echo $?

/*** Valgrind ***/

valgrind ./pipex_bonus tests_bonus/infiles/basic.txt "cat" "cat" tests_bonus/outfiles/outfile
valgrind ./pipex_bonus here_doc END "cat" "grep foo" "wc -l" tests_bonus/outfiles/outfile
valgrind ./pipex_bonus tests_bonus/infiles/basic.txt "cat" "nonexistingcmd" "wc -l" tests_bonus/outfiles/outfile
